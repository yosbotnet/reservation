generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model attrezzatura {
  codice                String          @id @db.VarChar(20)
  nome                  String          @db.VarChar(100)
  numero_sala           String          @db.VarChar(10)
  stato                 String          @db.VarChar(20)
  ultima_manutenzione   DateTime?       @db.Date
  prossima_manutenzione DateTime?       @db.Date
  sala_operatoria       sala_operatoria @relation(fields: [numero_sala], references: [numero], map: "Attrezzatura_numero_sala_fkey")

  @@index([numero_sala], map: "Attrezzatura_numero_sala_fkey")
}

model calendario_disponibilita {
  id         String   @id @db.VarChar(20)
  CF_medico  String   @db.VarChar(16)
  data       DateTime @db.Date
  ora_inizio DateTime @db.Time(0)
  ora_fine   DateTime @db.Time(0)
  medico     medico   @relation(fields: [CF_medico], references: [CF], map: "Calendario_Disponibilita_CF_medico_fkey")

  @@index([CF_medico], map: "Calendario_Disponibilita_CF_medico_fkey")
}

model cartella_clinica {
  id                   String                 @id @db.VarChar(20)
  CF_paziente          String                 @db.VarChar(16)
  data_apertura        DateTime               @db.Date
  data_chiusura        DateTime?              @db.Date
  diagnosi             String?                @db.Text
  paziente             paziente               @relation(fields: [CF_paziente], references: [CF], map: "Cartella_Clinica_CF_paziente_fkey")
  esame_pre_operatorio esame_pre_operatorio[]
  visita_controllo     visita_controllo[]

  @@index([CF_paziente], map: "Cartella_Clinica_CF_paziente_fkey")
}

model compagnia {
  id_compagnia         Int                    @id @default(autoincrement())
  nome                 String                 @unique(map: "Compagnia_nome_key") @db.VarChar(100)
  indirizzo            String?                @db.Text
  telefono             String?                @db.VarChar(20)
  polizza_assicurativa polizza_assicurativa[]
}

model cura_post_operativa {
  id               String     @id @db.VarChar(20)
  id_intervento    String     @db.VarChar(20)
  CF_medico        String     @db.VarChar(16)
  data             DateTime   @default(now()) @db.Timestamp(0)
  note             String     @db.Text
  parametri_vitali String     @db.Text
  medicazioni      String?    @db.Text
  terapia          String?    @db.Text
  complicanze      String?    @db.Text
  medico           medico     @relation(fields: [CF_medico], references: [CF], map: "cura_post_operativa_CF_medico_fkey")
  intervento       intervento @relation(fields: [id_intervento], references: [id], map: "cura_post_operativa_id_intervento_fkey")

  @@index([CF_medico], map: "Cura_Post_Operativa_CF_medico_idx")
  @@index([id_intervento], map: "Cura_Post_Operativa_id_intervento_idx")
}

model esame_pre_operatorio {
  id               String           @id @db.VarChar(20)
  id_cartella      String           @db.VarChar(20)
  tipo             String           @db.VarChar(50)
  data             DateTime         @db.Date
  risultato        String?          @db.Text
  validita_giorni  Int
  cartella_clinica cartella_clinica @relation(fields: [id_cartella], references: [id], map: "Esame_Pre_Operatorio_id_cartella_fkey")

  @@index([id_cartella], map: "Esame_Pre_Operatorio_id_cartella_fkey")
}

model farmaci_intervento {
  id_intervento  String     @db.VarChar(20)
  codice_farmaco String     @db.VarChar(20)
  quantita       Int
  farmaco        farmaco    @relation(fields: [codice_farmaco], references: [codice], map: "Farmaci_Intervento_codice_farmaco_fkey")
  intervento     intervento @relation(fields: [id_intervento], references: [id], map: "Farmaci_Intervento_id_intervento_fkey")

  @@id([id_intervento, codice_farmaco])
  @@index([codice_farmaco], map: "Farmaci_Intervento_codice_farmaco_fkey")
}

model farmaco {
  codice               String               @id @db.VarChar(20)
  nome                 String               @db.VarChar(100)
  dosaggio             String?              @db.VarChar(50)
  via_somministrazione String?              @db.VarChar(50)
  farmaci_intervento   farmaci_intervento[]
}

model infermiere {
  CF               String             @id @db.VarChar(16)
  reparto          String             @db.VarChar(50)
  personale        personale          @relation(fields: [CF], references: [CF], map: "Infermiere_CF_fkey")
  turni_infermiere turni_infermiere[]
}

model intervento {
  id                  String                @id @db.VarChar(20)
  CF_paziente         String                @db.VarChar(16)
  codice_tipo         String                @db.VarChar(20)
  numero_sala         String                @db.VarChar(10)
  data_ora            DateTime              @default(now()) @db.Timestamp(0)
  durata_prevista     Int
  stato               String                @db.VarChar(20)
  cura_post_operativa cura_post_operativa[]
  farmaci_intervento  farmaci_intervento[]
  paziente            paziente              @relation(fields: [CF_paziente], references: [CF], map: "Intervento_CF_paziente_fkey")
  tipo_intervento     tipo_intervento       @relation(fields: [codice_tipo], references: [codice], map: "Intervento_codice_tipo_fkey")
  sala_operatoria     sala_operatoria       @relation(fields: [numero_sala], references: [numero], map: "Intervento_numero_sala_fkey")
  medici_intervento   medici_intervento[]

  @@index([CF_paziente], map: "Intervento_CF_paziente_fkey")
  @@index([codice_tipo], map: "Intervento_codice_tipo_fkey")
  @@index([numero_sala], map: "Intervento_numero_sala_fkey")
}

model medici_intervento {
  id_intervento String     @db.VarChar(20)
  CF_medico     String     @db.VarChar(16)
  ruolo         String     @db.VarChar(50)
  medico        medico     @relation(fields: [CF_medico], references: [CF], map: "Medici_Intervento_CF_medico_fkey")
  intervento    intervento @relation(fields: [id_intervento], references: [id], map: "Medici_Intervento_id_intervento_fkey")

  @@id([id_intervento, CF_medico])
  @@index([CF_medico], map: "Medici_Intervento_CF_medico_fkey")
}

model medico {
  CF                       String                     @id @db.VarChar(16)
  num_albo                 String                     @unique(map: "Medico_num_albo_key") @db.VarChar(20)
  specializzazione         String                     @db.VarChar(100)
  calendario_disponibilita calendario_disponibilita[]
  cura_post_operativa      cura_post_operativa[]
  medici_intervento        medici_intervento[]
  personale                personale                  @relation(fields: [CF], references: [CF], map: "Medico_CF_fkey")
}

model paziente {
  CF                   String                 @id @db.VarChar(16)
  gruppo_sanguigno     String?                @db.VarChar(3)
  allergie             String?                @db.Text
  patologie_croniche   String?                @db.Text
  password             String?                @db.VarChar(100)
  cartella_clinica     cartella_clinica[]
  intervento           intervento[]
  persona              persona                @relation(fields: [CF], references: [CF], map: "Paziente_CF_fkey")
  polizza_assicurativa polizza_assicurativa[]
}

model persona {
  CF        String     @id @db.VarChar(16)
  nome      String     @db.VarChar(50)
  cognome   String     @db.VarChar(50)
  email     String     @unique(map: "Persona_email_key") @db.VarChar(100)
  telefono  String?    @db.VarChar(20)
  paziente  paziente?
  personale personale?
}

model personale {
  CF              String      @id @db.VarChar(16)
  data_assunzione DateTime    @db.Date
  qualifica       String      @db.VarChar(50)
  livello_accesso String      @db.VarChar(20)
  infermiere      infermiere?
  medico          medico?
  persona         persona     @relation(fields: [CF], references: [CF], map: "Personale_CF_fkey")
}

model polizza_assicurativa {
  numero        String    @id @db.VarChar(50)
  id_compagnia  Int
  CF_paziente   String    @db.VarChar(16)
  data_scadenza DateTime  @db.Date
  massimale     Decimal?  @db.Decimal(10, 2)
  paziente      paziente  @relation(fields: [CF_paziente], references: [CF], map: "Polizza_Assicurativa_CF_paziente_fkey")
  compagnia     compagnia @relation(fields: [id_compagnia], references: [id_compagnia], map: "Polizza_Assicurativa_id_compagnia_fkey")

  @@index([CF_paziente], map: "Polizza_Assicurativa_CF_paziente_fkey")
  @@index([id_compagnia], map: "Polizza_Assicurativa_id_compagnia_fkey")
}

model protocollo_post_operatorio {
  codice        String @id @db.VarChar(20)
  descrizione   String @db.Text
  durata_giorni Int
  istruzioni    String @db.Text
}

model sala_operatoria {
  numero       String         @id @db.VarChar(10)
  piano        Int
  tipo_sala    String         @db.VarChar(50)
  attrezzatura attrezzatura[]
  intervento   intervento[]
}

model tipo_intervento {
  codice          String       @id @db.VarChar(20)
  nome            String       @db.VarChar(100)
  descrizione     String?      @db.Text
  complessita     Int
  durata_standard Int
  intervento      intervento[]
}

model turni_infermiere {
  id_turno      String     @db.VarChar(20)
  CF_infermiere String     @db.VarChar(16)
  infermiere    infermiere @relation(fields: [CF_infermiere], references: [CF], map: "Turni_Infermiere_CF_infermiere_fkey")
  turno         turno      @relation(fields: [id_turno], references: [id], map: "Turni_Infermiere_id_turno_fkey")

  @@id([id_turno, CF_infermiere])
  @@index([CF_infermiere], map: "Turni_Infermiere_CF_infermiere_fkey")
}

model turno {
  id               String             @id @db.VarChar(20)
  data             DateTime           @db.Date
  ora_inizio       DateTime           @db.Time(0)
  ora_fine         DateTime           @db.Time(0)
  tipo_turno       String             @db.VarChar(20)
  turni_infermiere turni_infermiere[]
}

model visita_controllo {
  id               String           @id @db.VarChar(20)
  id_cartella      String           @db.VarChar(20)
  data_ora         DateTime         @default(now()) @db.Timestamp(0)
  tipo             String           @db.VarChar(50)
  esito            String?          @db.Text
  cartella_clinica cartella_clinica @relation(fields: [id_cartella], references: [id], map: "Visita_Controllo_id_cartella_fkey")

  @@index([id_cartella], map: "Visita_Controllo_id_cartella_fkey")
}
